(function (e) {
    var t = function (t) {
        var n, r, i, s, o, u, a, f, l, c, h, p, d, v, m;
        e(this).mousedown(function (g) {
            g.preventDefault();
            if (g.target == this) {
                if (e.isFunction(t.onStart)) {
                    t.onStart.call(this)
                }
                g.stopPropagation();
                p = "down";
                n = g.pageY;
                r = g.pageX;
                i = e(this).offset();
                s = e(this).width();
                o = e(this).height();
                f = n - i.top;
                l = r - i.left;
                h = e(this);
                c = e(this).clone();
                h.css("visibility", "hidden");
                c.css({
                    position: "absolute",
                    "z-index": 1e3,
                    width: s,
                    left: i.left,
                    top: i.top
                }).attr("id", t.helper).appendTo("body");
                e(this).trigger("dragstart");
                e("*").mousemove(function (i) {
                    i.preventDefault();
                    if (p == "down") {
                        n = i.pageY;
                        r = i.pageX;
                        u = r - l;
                        a = n - f;
                        c.hide();
                        v = d;
                        d = document.elementFromPoint(r, n);
                        c.show();
                        c.css({left: u, top: a});
                        if (e.isFunction(t.onDrag)) {
                            t.onDrag.call(d)
                        }
                        e(c).trigger("drag");
                        if (v != d) {
                            e(d).trigger("dragin");
                            e(v).trigger("dragout")
                        }
                    }
                });
                e(document).one("mouseup", function (n) {
                    p = "up";
                    if (e.isFunction(t.onDrop)) {
                        t.onDrop.call(e(d))
                    }
                    c.remove();
                    h.css("visibility", "");
                    m = document.elementFromPoint(n.pageX, n.pageY);
                    e(m).trigger("drop")
                })
            }
        })
    };
    var n = {
        init: function (e) {
            return this.each(function (n) {
                t.call(this, e)
            })
        }, destroy: function (t) {
            return e(this).each(function () {
                e(this).off("mousedown")
            })
        }
    };
    e.fn.dragg = function (t, r) {
        if (!t || jQuery.isPlainObject(t) || !n[t]) {
            r = t;
            t = "init"
        }
        var i = {
            helper: "helper", onStart: function () {
            }, onDrag: function () {
            }, onDrop: function () {
            }
        };
        var r = e.extend({}, i, r);
        return n[t].call(this, r)
    }
})(jQuery)