<template>
  <div class="day-root" :class="[currentDate === day.date && 'day-today', mode === 'list' ? 'day-list' : 'day-natural']">
    <div class="day-header">
      <DayHeader :day="day" :is-editing="isEditing" :resource="resource" />
    </div>
    <div class="hours" v-if="mode !== 'list'">
      <div class="hour" v-for="h in allHours" :key="h">
        <div class="hour-label">{{ h }}</div>
        <div class="hour-buttons" v-if="isEditing">
          <a href="#" class="a-under" title="Создать слот" @click.prevent="createSlot(h)" v-tippy><i class="fa fa-plus"></i></a>
        </div>
        <div class="hour-border"></div>
      </div>
    </div>
    <TimeSlot v-for="s in day.slots" :key="s.id" :data="s" :mode="mode" :services="services" :allHoursValues="allHoursValues" />
    <TimeMarker v-if="currentDate === day.date && mode !== 'list'" :time="currentTime" :allHoursValues="allHoursValues" />
    <button class="btn btn-blue-nb btn-sm btn-block nbr" v-if="isEditing" @click.prevent="createSlot()">Создать слот</button>
  </div>
</template>

<script lang="ts">
import Vue from 'vue';
import Component from 'vue-class-component';
import TimeSlot from './TimeSlot.vue';
import TimeMarker from './TimeMarker.vue';
import DayHeader from './DayHeader.vue';

@Component({
  components: {
    TimeSlot,
    TimeMarker,
    DayHeader,
  },
  props: {
    day: {
      type: Object,
      required: true,
    },
    currentDate: {
      type: String,
      required: true,
    },
    currentTime: {
      type: String,
      required: true,
    },
    allHours: {
      type: Array,
      required: true,
    },
    allHoursValues: {
      type: Array,
      required: true,
    },
    mode: {
      type: String,
    },
    isEditing: {
      type: Boolean,
    },
    resource: {
      type: Number,
      required: true,
    },
    services: {
      type: Array,
      required: true,
    },
  },
})
export default class Day extends Vue {
  day: any;

  allHours: any[];

  allHoursValues: any[];

  currentDate: string;

  currentTime: string;

  mode: string | null;

  resource: number;

  services: any[];

  getOffset(s) {
    const offset = s.minute * 2 + this.allHoursValues.indexOf(s.hourValue) * 120 + 51;
    return `${offset}px`;
  }

  createSlot(time) {
    this.$root.$emit('schedule:create-one-slot', this.day.date, time);
  }
}
</script>

<style lang="scss" scoped>
$border-color: #000;
$hour-height: 120px;

.day-root {
  width: calc(100% / 7);
  min-height: 100%;
  flex: 0 calc(100% / 7);
  border-right: 1px solid $border-color;
  position: relative;
  background-color: #fff;

  &.day-today {
    background-color: #f4fffc;
  }
}

.day-today .day-header {
  background-color: #d3efe7;
}

.day-header {
  border-bottom: 1px solid $border-color;
  padding: 5px;
  text-align: center;
  position: sticky;
  top: 0;
  z-index: 3;
  background-color: #fff;
  height: 51px;
}

.hour {
  position: relative;
  height: $hour-height;
  width: 100%;
  overflow: visible;
  padding-bottom: 1px;

  &-border {
    content: '';
    display: block;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background-color: $border-color;
    z-index: 0;
  }

  &-label {
    position: absolute;
    top: 3px;
    left: 3px;
    font-size: 12px;
  }

  &-buttons {
    position: absolute;
    top: 18px;
    left: 3px;
    font-size: 12px;
  }
}
</style>
